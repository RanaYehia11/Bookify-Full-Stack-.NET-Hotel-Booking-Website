@model List<Bookify.Data.Models.RoomType>

@{
    ViewData["Title"] = "Manage Room Types";
    Layout = "_Layout";
}

<section class="spad">
    <div class="container">
        <h2 class="text-center mb-4" style="color:#8B4513;">Manage Room Types</h2>

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">@TempData["SuccessMessage"]</div>
        }

        <form asp-action="SaveRoomTypes" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" id="deletedIds" name="deletedIds" />

            <table class="table table-bordered table-striped" id="roomTypesTable">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Price per Night</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.Count; i++)
                    {
                        <tr data-id="@Model[i].Id">
                            <input type="hidden" name="model[@i].Id" value="@Model[i].Id" />
                            <td><input name="model[@i].Name" value="@Model[i].Name" class="form-control" /></td>
                            <td><input name="model[@i].Description" value="@Model[i].Description" class="form-control" /></td>
                            <td><input name="model[@i].PricePerNight" value="@Model[i].PricePerNight" class="form-control" /></td>
                            <td>
                                <button type="button" class="btn btn-danger btn-sm deleteRow">Delete</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <button type="button" class="btn btn-success mb-3" id="addRow">+ Add Room Type</button>
            <br />
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
    </div>
</section>

@section Scripts {
    <script>
        let deletedIds = [];

        function attachDeleteHandlers() {
            document.querySelectorAll(".deleteRow").forEach(btn => {
                btn.onclick = function () {
                    let row = this.closest("tr");
                    let id = row.dataset.id;
                    if (id && id != "0") deletedIds.push(id);
                    row.remove();
                    document.getElementById("deletedIds").value = deletedIds.join(',');
                }
            });
        }

        document.getElementById("addRow").addEventListener("click", function () {
            let table = document.getElementById("roomTypesTable").getElementsByTagName('tbody')[0];
            let index = table.rows.length;

            let row = table.insertRow();
            row.dataset.id = "0"; // new row
            row.innerHTML = `
                <input type="hidden" name="model[${index}].Id" value="0" />
                <td><input name="model[${index}].Name" class="form-control" /></td>
                <td><input name="model[${index}].Description" class="form-control" /></td>
                <td><input name="model[${index}].PricePerNight" class="form-control" /></td>
                <td><button type="button" class="btn btn-danger btn-sm deleteRow">Delete</button></td>
            `;

            attachDeleteHandlers();
        });

        attachDeleteHandlers();
    </script>
}
